else if (message.content.startsWith("!rain")) {
  var params = message.content.split(" ");
  var amount = params[1];
  var rgx = /^[0-9]+$/;
  if (amount == "undefined" || amount == null || amount == "") {
    message.author.send("Invalid amount - please type a valid amount. Syntax is: !rain [amount]");
    console.log("rain - invalid amount2");
  }
  else if (!amount.match(rgx)) {
    message.author.send("Invalid amount - please type a valid amount. Syntax is: !rain [amount]");
    console.log("rain - invalid amount2");
  }
  else {    
    var allusers = client.guilds.get("579535518233264148"); //use this
    var allusersarray = [];

    allusers.members.forEach(
    member => {
        if (member.user.id != message.author.id && member.presence.status == "online") {
          allusersarray.push(member.user.id + "|" + member.user.username);
        }        
      }
    );

    if (allusersarray.length == 0) {
      console.log("No users met criteria of online");
      msg = "Hi <@" + message.author.id + ">, there are currently no users online to tip.";
      var y = "<@" + message.author.id + ">";
      var embed = new Discord.RichEmbed()
      .setColor(0x9932CC)
      .setThumbnail("https://audaxproject.io/img/audax-logo-full-white-254x99.png")
      .setURL("https://discord.js.org/#/docs/main/indev/class/RichEmbed")    
      .addField("Rain on Online Users:", "No users currently online to tip", true);    
      message.channel.send({embed});
    }

    if (allusersarray.length > 0) {
      var request = require('request');
      var data = '{"task" : "rain", "userid" : "' + message.author.id + '", "username" : "' + message.author.username + '", "usersarray" : "' + allusersarray + '", "amount" : "' + amount + '"}';
      var json_obj = JSON.parse(data);
      request.post({
        headers: {'content-type': 'application/json'},
        url: 'https://util.audaxproject.io/audaxbot/tipbot.php',
        form: json_obj
      }, function(error, response, body) {
        console.log(body);        
        if (body != "") {
          var res = body.split("|");
          var msg;
          if (res[0] == "Success") {
            console.log(res[1]);
            var onlineusers = res[1].split("--");
            var c;
            var tipees = "\n";
            var eachamount = res[2];
            eachamount = parseFloat(eachamount).toFixed(8);
            for (c = 0; c < onlineusers.length; c++) {
              var row = onlineusers[c];
              msg = "<@" + row + ">";
              tipees = tipees + msg + "\n";
            }
            
            var y = "<@" + message.author.id + ">";
            var embed = new Discord.RichEmbed()
            .setColor(0x9932CC)
            .setThumbnail("https://audaxproject.io/img/audax-logo-full-white-254x99.png")
            .setURL("https://discord.js.org/#/docs/main/indev/class/RichEmbed")    
            .addField("AUDAX Rain Successful!", y + " rained " + eachamount + " AUDAX each on the following online users:\n " + tipees, true);    
            message.channel.send({embed});
          }
          else if (res[0] == "Error") {
            console.log(res[1]);
            if (res[1].indexOf("Insufficient") > -1) {
              msg = "Oops! <@" + message.author.id + ">, looks like your tip account has insufficient funds - I am unable to send this tip";
            }
            else if (res[1].indexOf("Unable to send funds at this time") > -1) {
              msg = "Hi <@" + message.author.id + ">, something seems to have gone wrong. I am unable to send tip  - please try again later";
            }
            else if (res[1].indexOf("Recipient does not have an account") > -1) {
              msg = "<@" + message.author.id + ">, the user you want to tip does not have a tip account - please let them know to use the !address command to create one first";
            }
            else if (res[1].indexOf("Unable to get Tipper address") > -1 || res[1].indexOf("Tipper has no address") > -1) {
              msg = "Hey <@" + message.author.id + ">, you do not currently have a AUDAX Tip address. Send me the !address command and I will automagically generate one for you!";
            }
            else if (res[1].indexOf("Nobody online") > -1) {
              msg = "Hey <@" + message.author.id + ">, there's currently nobody else online, so no tip was sent.";
            }
            else {
              msg = "Oops! <@" + message.author.id + ">, something seems to have gone wrong. I am unable to send this tip  - please try again later";
            }
            message.author.send(msg);
          }
        }
        else {
          msg = "Hey <@" + message.author.id + ">, something seems to have gone wrong. Unable to send tip  - please try again later";
          message.author.send(msg);
        }
     }
      );
      }
      else { //tell tipper there is no one online to tip

      }
  }
}
